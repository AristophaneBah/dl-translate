# backend/app/pdf/civ_pdf.pyfrom pathlib import Pathfrom datetime import datetimefrom reportlab.lib.pagesizes import letterfrom reportlab.platypus import SimpleDocTemplate, Paragraph, Table, TableStyle, Spacerfrom reportlab.lib.styles import getSampleStyleSheetfrom reportlab.lib import colorsOUTPUT_DIR = Path(__file__).resolve().parents[2] / "outputs"OUTPUT_DIR.mkdir(parents=True, exist_ok=True)def build_civ_translation_pdf(fields_fr: dict, fields_en: dict, normalized: dict | None = None) -> Path:    """    Builds a CIV driver's license translation PDF and returns the file path.    'normalized' is optional.    """    normalized = normalized or {}    # ✅ Safe filename    out_path = OUTPUT_DIR / "civ_driver_license_translation.pdf"    doc = SimpleDocTemplate(str(out_path), pagesize=letter)    styles = getSampleStyleSheet()    story = []    # ✅ Header    story.append(Paragraph("<b>REPUBLIC OF COTE D'IVOIRE</b>", styles["Title"]))    story.append(Paragraph("<b>MINISTRY OF TRANSPORTATION</b>", styles["Heading2"]))    story.append(Paragraph("<b>DRIVER'S LICENSE - CERTIFIED TRANSLATION</b>", styles["Heading2"]))    story.append(Spacer(1, 16))    # ✅ Table rows: keep it close to the card order    rows = [        ["No.", "Original (French)", "English Translation"],        ["1", "Nom", f"Last Name: {fields_en.get('Last Name','')}"],        ["2", "Prénoms", f"First Names: {fields_en.get('First Names','')}"],        ["3", "Date et lieu de naissance", f"Date of Birth: {fields_en.get('Date of Birth','')}  |  Place of Birth: {fields_en.get('Place of Birth','')}"],        ["4", "Date et lieu de délivrance", f"Issue Date: {fields_en.get('Issue Date','')}  |  Issue Place: {fields_en.get('Issue Place','')}"],        ["5", "Numéro du permis de conduire", f"License Number: {fields_en.get('License Number','')}"],        ["6", "Restriction(s)", f"Restrictions: {fields_en.get('Restrictions','None indicated')}"],    ]    table = Table(rows, colWidths=[40, 220, 300])    table.setStyle(        TableStyle(            [                ("BACKGROUND", (0, 0), (-1, 0), colors.lightgrey),                ("TEXTCOLOR", (0, 0), (-1, 0), colors.black),                ("GRID", (0, 0), (-1, -1), 1, colors.black),                ("FONTNAME", (0, 0), (-1, 0), "Helvetica-Bold"),                ("FONTNAME", (0, 1), (-1, -1), "Helvetica"),                ("VALIGN", (0, 0), (-1, -1), "MIDDLE"),                ("ALIGN", (0, 0), (0, -1), "CENTER"),                ("ALIGN", (0, 0), (-1, 0), "CENTER"),                ("BOTTOMPADDING", (0, 0), (-1, 0), 8),                ("TOPPADDING", (0, 0), (-1, 0), 8),            ]        )    )    story.append(table)    story.append(Spacer(1, 22))    # ✅ Certification section    today = datetime.now().strftime("%B %d, %Y")    translator_name = normalized.get("translator_name", "Aristophane Bah")  # default    story.append(Paragraph("<b>Certification of Translation Accuracy</b>", styles["Heading2"]))    story.append(Spacer(1, 8))    story.append(        Paragraph(            "I certify that I am competent to translate from French to English and that the above translation is a true and accurate translation of the original document.",            styles["BodyText"],        )    )    story.append(Spacer(1, 14))    story.append(Paragraph(f"<b>Translator Name:</b> {translator_name}", styles["BodyText"]))    story.append(Paragraph("<b>Signature:</b> _______________________________", styles["BodyText"]))    story.append(Paragraph(f"<b>Date of Translation:</b> {today}", styles["BodyText"]))    doc.build(story)    return out_pathdef safe(v, fallback="—"):    return v if v else fallback